const backendUrl="https://api.accbuddy.com/public";let customer,cart=getShoppingCart(),product=fetchProductById(cart.itemID);const token=getAccessToken();let qty=1,total=0;function getShoppingCart(){var e=localStorage.getItem("cart");if(e)return JSON.parse(e)}function getAccessToken(){var e=localStorage.getItem("AuthenticationResult");if(e)return JSON.parse(e).AccessToken}async function fetchProductById(e){e={fetchProductByID:{productID:e}};return fetch(backendUrl,{method:"POST",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>e.result)}async function fetchCustomerByAccessToken(e){var t=new Headers;return t.set("Authorization",e),fetch(backendUrl,{method:"POST",headers:t,body:JSON.stringify({fetchCustomer:!0})}).then(e=>e.json()).then(e=>e.result)}function generateUUID(){let n=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"===e?t:3&t|8).toString(16)})}function sleep(t){return new Promise(e=>setTimeout(e,t))}async function openPopup(){const e=disableppButon();product=await product,customer=await customer;for(var t={ppCreateOrder:{intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:total.toString()}}]},shoppingCartData:{quantity:qty.toString(),itemID:cart.itemID.replace("productID-",""),discount:customer?.customerDiscount?.toString()||"0",customerID:customer?.PK||"guest-"+generateUUID()}},n=new Headers,o=(n.set("Authorization",token),await fetch(backendUrl,{method:"POST",headers:n,body:JSON.stringify(t)}).then(e=>e.json()).then(e=>e.response)),r=(enableppButon(e),window.open(o,"newwindow","width=600,height=600"));!r?.closed;)console.log("not closed"),await sleep(1e3);disableppButon();o=o.split("?token=")[1];console.log(o),t={createShopOrderId:o};try{const e=await fetch(backendUrl,{method:"POST",headers:n,body:JSON.stringify(t)}).then(e=>e.json()).then(e=>e.response);window.location.href=`./payment-receved.html?email=${e.email}&orderId=`+e.shopId}catch(e){window.location.href="./payment-failed.html"}}function disableppButon(){var e=document.getElementById("pp-button"),t=(e.classList.add("inactive"),e.innerHTML);return e.innerHTML="Processing...",t}function enableppButon(e){var t=document.getElementById("pp-button");t.classList.remove("inactive"),t.innerHTML=e}function showButton(t){let n;console.log("clicked"),document.getElementsByName("checkbox").forEach(function(e){e.id!==t?e.checked=!1:n=e.checked});var e=document.getElementById("pp-button"),o=document.getElementById("buy-button");"abPayment1"===t&&n?(o.style.display="none",e.style.display="flex"):(e.style.display="none",o.style.display="flex")}async function calculateTotal(){var e=document.querySelector(".ab-quantity-number"),t=(await product)["productPrice"],n=document.querySelector(".ab-order-price"),n=(n&&(n.innerHTML="$"+t),(await customer)?.customerDiscount||0),o=document.querySelector(".ab-discount-title + .ab-order-price"),o=(o&&(o.innerHTML="-$"+t*parseInt(e.value)*n/100),qty=parseInt(e.value),total=t*parseInt(e.value)*(1-n/100),document.querySelector(".ab-due-title + .ab-order-price"));o&&(o.innerHTML="$"+total)}token&&(customer=fetchCustomerByAccessToken(token)),document.addEventListener("DOMContentLoaded",async function(){await cart||(document.querySelector(".ab-order-title.ab-violate-color").innerHTML="Shopping card is empty");var{productDescr:e,productImageUrl:t,productName:n,productImageText:o,productQty:r,productWarning:c}=await product,a=document.querySelector(".ab-order-account-icons"),t=(a&&(a.src=t,a.alt=o),document.querySelector(".ab-order-info-title.ab-violate-color")),a=(t&&(t.innerHTML=n),document.querySelector(".ab-order-info-desc")),o=(a&&(a.innerHTML=e),document.querySelector(".ab-available-quantity span")),t=(o&&(o.innerHTML=r),document.querySelector(".ab-note-desc")),n=(t&&(t.innerHTML=c),await calculateTotal(),document.querySelector(".ab-preloader-screen"));n&&n.parentNode.removeChild(n)});